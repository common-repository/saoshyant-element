(function ($, undefined) {
	  'use strict';
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			 Isset
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/  
	  
	function isset(variable){
		return  variable  !== "undefined" && variable  !== "0" && variable !== null && variable !== '';
	}
	
	function empty(variable){
		if(variable  === "undefined" && variable === null && variable === ''){
			return '';
		}else{
			return variable;
		}
	}
		
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			 Slide Json
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
	$.fn.sor_slide_json =  function() { 
  		var slide =  [];
 		$('.sor_module_slide_item').each(function(i) {
 			 $(this).attr('data-count',i+1);
			var key = $(this).attr('data-key');
 			var value = $(this).attr('data-value');
  			var option = $(this).find('.sor_module_slide_option').html();
 			var layer = $(this).find('.sor_module_slide_layer').html();
 
			var slide_key  = {};
			  slide_key[key] = {'value' : value,'option':option ,'layer':layer };
			 slide.push(slide_key); 
 		});
		$('#sor_slide').val( JSON.stringify(slide));
	};

		
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Sortable
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	

	$.fn.sor_sortable =  function() { 
 		
		$('.sor_module_slide_list').sortable({
			opacity: 0.6,
 			update: function() {
  				$('body').sor_slide_json();
				 $('body').sor_reload_global_slider();
 			}			
		});
 	};

  
	
	
	
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Start Document Ready
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
 
	jQuery(document).ready(function() {
		$('body').sor_sortable();
 /*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			ADD Slide
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
	  
	  
 	$('.sor_metabox').on('click', '.sor_module_slide_add', function() {
		
		var title_name= 'اسلاید جدید';
		$('.sor_module_slide_title').each(function() {
			var name = $(this).html();
			
			var substr = [1,2,3,4,5,6,7,8,9,10,11,12,13,13,14,15,16,17,18,20];
			$.each(substr , function(index) { 
				if(name === 'اسلاید جدید ('+index+')'){
					title_name = 'اسلاید جدید ('+(index + 1)+')';
				}
			});
			if(name === 'اسلاید جدید'){
					title_name = 'اسلاید جدید (2)';
			}		 
		});
		
		
		
		$('body').append('<div class="sor-mouse-wait"></div>');
  		var data_key = 'r'+Math.floor(Math.random() * 9999999999);
		
  		$.ajax({
			type: 'POST',
  			url: sorsorak.ajaxurl,
			data : {
				action : 'sor_module_slide_item',
				key : data_key,
				value :  'slide',
				default :  '1',
				default_title :  title_name,
	
 			},
			success:function(data) {
 				if(data.length){
					$('.sor_module_slide_list').append(data);
  					$('.sor-mouse-wait').remove();
					$('body').sor_slide_json();
				 $('body').sor_reload_global_slider();
    				} else{
					$('body').sor_remove_add_error_loading();
  				}
   			} 
		});
  	});	
	
	$('.sor_metabox').on('click', ".sor_module_slide_remove", function(e) {
		$(this).parents('.sor_module_slide_item').fadeOut("normal", function() {
		$(this).remove();
				$('body').sor_slide_json();
				 $('body').sor_reload_global_slider();

		});
 	});
	
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Slide Duplicate
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
	function sor_duplicate(row,key,adress) {	
		$(adress).attr('data-key',key).attr('id',"sor_"+row+"_"+ key);
 	}
		
	jQuery(document).on("click",".sor_module_slide_duplicate",function(){
   
   		var duplicate = $(this).parents(".sor_module_slide_item").addClass('sor_duplicate').clone();
		$(this).parents('.sor_duplicate').removeClass('sor_duplicate');
		$(this).parents(".sor_module_slide_item ").after(duplicate);
 		var slide_key = 'r'+Math.floor(Math.random() * 9999999999);
  		sor_duplicate('module_slide',slide_key,'.sor_duplicate');
 		$('.sor_duplicate').removeClass('sor_duplicate');
		
		$('body').sor_slide_json();
		$('body').sor_reload_global_slider();
 
 }); 		 
		
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Slide Optins
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
	 
	$('.sor_metabox').on('click', ".sor_module_slide_options", function(e) {
		
 		$('body').append('<div class="sor-mouse-wait"></div>');
		
  		var data_key = $(this).parents('.sor_module_slide_item').attr('data-key');
  		var data_count = $(this).parents('.sor_module_slide_item').attr('data-count');
  		var data_option = $(this).parents('.sor_module_slide_item').find('.sor_module_slide_option').html();
  		var data_layer = $(this).parents('.sor_module_slide_item').find('.sor_module_slide_layer').html();
 		var data_this = $(this);
		var data_setting_json = $('#sor_setting_json').val();
 
  		var data_tablet=  $('.sor_live_setting_responsive_tablet').find('input:checked').val();
  		var data_mobile=  $('.sor_live_setting_responsive_mobile').find('input:checked').val();
  

   		$.ajax({
			type: 'POST',
 			url: sorsorak.ajaxurl,
			data : {
				action : 'sor_module_panel_options',
 				option :  data_option,
 				layer :  data_layer,
 				key :  data_key,
 				count :  data_count,
 				sor_setting_json :  data_setting_json,
 				sor_tablet :  empty(data_tablet),
 				sor_mobile :  empty(data_mobile),
				 
			},
			success:function(data) {
 				if( data.length){
					$('body').append(data);
   					$(".sor-mouse-wait").remove(); 
									
				 
 
						$('body').sor_fold_hide();
						 $('body').sor_sortable_layer();
						 $('body').sor_draggable();
						 $('body').sor_coloris();
 						$('body').sor_fold_item();
						$('body').find('.sor_module_layer_item').each(function() {
							$(this).sor_layer_options_perview();
						}); 
						
						$( ".sor_perview_slide .sor_perview_heading_desktop" ).trigger( "click" );
   	  
					//sor_add_hander('#sor_options_' +data_key);
  				}else{
					$('body').sor_remove_add_error_loading(); 	
				}
   			} 
		});	
  	});	
	
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																		 Slide Options Side
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
*************************************************************************************************************************************************************************/
 
 	$(document).on('click', '.sor_module_slide_options_show', function() {
		$(this).addClass('sor_module_slide_options_active');
  		 $(this).parents('.sor_panel').find('.sor_module_side_options_active').removeClass('sor_module_side_options_active');
   		 $('#sor_module_slide_options').addClass('sor_module_side_options_active');
  		 $(this).parents('.sor_panel').addClass('sor_panel_options_active');
 		 
  		 $(this).parents('.sor_panel').find('.sor_draggable_active').removeClass('sor_draggable_active');
 		$('.sor_module_side_options_active').sor_fold_item();
  
 	
	
	});
 	
	
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Slide Save
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/		
		
	$(document).on('click', '.sor_panel_save', function() {
		var has_title ='';
		var data_key = $(this).parents('.sor_panel').attr('data-key');
		
	 
	 
			$('body').append('<div class="sor-mouse-wait"></div>');
			var data_slide_option = $(this).parents('.sor_panel').find('#sor_module_slide_options').serializeJSON();
			var data_layer =$('body').sor_layer_json();
			console.log(data_layer);
 			var data_this = $(this);
	 
			
			$('#sor_module_slide_'+data_key).find('.sor_module_slide_inner').remove();
			 
			$.ajax({
				type: 'POST',
				url: sorsorak.ajaxurl,
				data : {
					action : 'sor_module_slide_inner',
					option :  data_slide_option,
					layer :  data_layer,
				},
				success:function(data) {
						if( data.length){
						$('#sor_module_slide_'+data_key).append(data);
							$('.sor-mouse-wait').remove(); 
							$(data_this).parents('.sor_panel').remove();
							 $('body').sor_slide_json();
							 $('body').sor_sortable_layer();
						 $('body').sor_reload_global_slider();

						}else{
							$('body').sor_remove_add_error_loading(); 	
						}
					} 
					
			 }); 
		 
	});  
	$(document).on('click', '.sor_panel_cancel', function() {
		$(this).parents('.sor_panel').remove();
	});  
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																			Ready END 
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/		
});  
	
	
})(jQuery);

		