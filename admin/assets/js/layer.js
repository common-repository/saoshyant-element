(function ($, undefined) {
	  'use strict';
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 																			 Isset 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/  
	  
	function isset(variable){
		return  variable  !== "undefined" && variable  !== "0" && variable !== null && variable !== '';
	}
	
	function empty(variable){
		if(variable  === "undefined" && variable === null && variable === ''){
			return '';
		}else{
			return variable;
		}
	}
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 																			 Layer Json 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/  	
	$.fn.sor_layer_json =  function() { 
 			var layer_key  = {};
 		$('.sor_module_layer_item').each(function() {
			var key = $(this).attr('data-key');
 			var id = $(this).attr('data-id');
 			var option = $(this).find('#sor_layer_options').serializeJSON();
  
 			  layer_key[key] = {'id' : id,'option':option };
  		});
		
		return layer_key;
 
  	};
 
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 																			 sortable layer 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/   	
	$.fn.sor_sortable_layer =  function() { 
  		$('.sor_module_layer_list').sortable({
			handle: ".sor_module_layer_title",
 			opacity: 0.6,
			update: function() {
 				 $('body').sor_reload_layer();
 			}	
			 		
		});
 	}; 
	
  /*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 																			 reload layer 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/  
   
   $.fn.sor_reload_layer =  function() { 

	  $('.sor_perview_slide_content').addClass('sor-loading');
	  
	  var data_layer = $('body').sor_layer_json();;
		 setTimeout(function(){  
     		 
  		$.ajax({
			type: 'POST',
  			url: sorsorak.ajaxurl,
			data : {
				action : 'sor_perview_layer',
 				layer_json : data_layer,
  			},
			success:function(data) {
 				if(data.length){
				$('.sor_perview_slide_content .sor-perview-slide .sor-layer-warp').remove();
				 $('.sor-perview-slide').append(data);
      				
						$('.sor_perview_slide_content').removeClass('sor-loading');
						$('body').find('.sor_module_layer_item').each(function() {
							$(this).sor_layer_options_perview();
						}); 
					 	$('body').sor_sortable_layer();
						$('body').sor_draggable();
						$('body').sor_coloris();
						$('body').sor_fold_item();
						 
					} else{
					$('body').sor_remove_add_error_loading();
  				}
   			} 
		}); 
		  }, 10);

  };	
	
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 																		document Ready
 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/			
   	jQuery(document).ready(function() {
 /*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 																			Module Layer
 --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
/* Section Options Update*/
 
	$(document).on('click', '.sor_module_layer_add', function(e) {
  		 $('.sor_add_layer').addClass('sor_add_layer_active'); 	}); 
	
	$(document).on('click', '.sor_add_layer_cancel', function(e) {
  		 $('.sor_add_layer').removeClass('sor_add_layer_active');
 	
	});
	
$(document).on("click",".sor_add_layer_item", function() {
		$(this).parents('.sor_add_layer_content').find('.selected').removeClass('selected');
		$(this).addClass('selected');
 	}); 
		
/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 																			Add Layer
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
 	$(document).on('click', '.sor_add_layer_add', function() {
		
		$('body').append('<div class="sor-mouse-wait"></div>');
  		var data_key = 'r'+Math.floor(Math.random() * 9999999999);
		var data_id = $('.sor_add_layer').find('.selected').attr('data-layer');
 
  		var data_tablet=  $('.sor_live_setting_responsive_tablet').find('input:checked').val();
  		var data_mobile=  $('.sor_live_setting_responsive_mobile').find('input:checked').val();
 
  		$.ajax({
			type: 'POST',
  			url: sorsorak.ajaxurl,
			data : {
				action : 'sor_module_layer_item',
				layer_key : data_key,
				layer_id :  data_id,
				default :  '1',
	 				sor_tablet :  empty(data_tablet),
 				sor_mobile :  empty(data_mobile),			
				
 			},
			success:function(data) {
 				if(data.length){
					$('.sor_module_layer_list').append(data);
  					$('.sor-mouse-wait').remove();
					$('.sor_add_layer').removeClass('sor_add_layer_active');
					$('body').sor_reload_layer();

     				} else{
					$('body').sor_remove_add_error_loading();
  				}
   			} 
		}); 
  	});	

/*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 																		 Layer duplicate
 --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
			function sor_duplicate(row,key,adress) {	
		$(adress).attr('data-key',key).attr('id',"sor_"+row+"_"+ key);
 	}
	jQuery(document).on("click",".sor_module_layer_duplicate",function(){
   
   		var duplicate = $(this).parents(".sor_module_layer_item").addClass('sor_duplicate').clone();
		$(this).parents('.sor_duplicate').removeClass('sor_duplicate');
		$(this).parents(".sor_module_layer_item ").after(duplicate);
 		var layer_key = 'r'+Math.floor(Math.random() * 9999999999);
  		sor_duplicate('module_layer',layer_key,'.sor_duplicate');
 		$('.sor_duplicate').removeClass('sor_duplicate');
		
 		$('body').sor_reload_layer();	
 
 }); 

 /*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 																		 Layer Active
 --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
		
	$(document).on('click', '.sor_module_layer_title ', function() {
		
  		 $(this).parents('.sor_panel').find('.sor_module_side_options_active,.sor_module_slide_options_active').removeClass('sor_module_side_options_active sor_module_slide_options_active');
   		 $(this).parents('.sor_module_layer_item').addClass('sor_module_side_options_active');
  		 $(this).parents('.sor_panel').addClass('sor_panel_options_active');
 		 
  		 $(this).parents('.sor_panel').find('.sor_draggable_active').removeClass('sor_draggable_active');
  		 var data_key = $(this).parents('.sor_module_layer_item').attr('data-key');
		  $('#sor_perview_layer_'+data_key).addClass('sor_draggable_active');
		  		$('.sor_module_side_options_active').sor_fold_item();
				
 
 	
	
	});
 		
  /*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 																		 Layer Close
 --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
	$(document).on('click', '.sor_module_side_options_close', function() {
  		 $(this).parents('.sor_panel').find('.sor_module_side_options_active,.sor_module_slide_options_active').removeClass('sor_module_side_options_active sor_module_slide_options_active');
   		  $(this).parents('.sor_panel_options_active').removeClass('sor_panel_options_active');
  	});		
	$(document).on('click', '.sor_perview_slide  .sor-slide-cover', function(e) {
		$('.sor_draggable_active').removeClass('sor_draggable_active');
		$('.sor_module_side_options_active').removeClass('sor_module_side_options_active');
		$('.sor_panel_options_active').removeClass('sor_panel_options_active');
 
	});
  /*************************************************************************************************************************************************************************
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 																		 Layer Remove
 --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**************************************************************************************************************************************************************************/	
				
		 
	  $(document).on('click', '.sor_module_layer_remove', function() {
  		 $(this).parents('.sor_module_layer_item').remove();
 			var key =$(this).parents('.sor_module_layer_item').attr('data-key');
 		$('.sor_module_side_options_active').removeClass('sor_module_side_options_active');
		$('.sor_panel_options_active').removeClass('sor_panel_options_active');
 
		$('#sor_perview_layer_'+key).remove();
 	
	});  
  
function sor_align_change(type,position) {	
 	 $(document).on('click', ".sor_live_layer_"+type+"align_"+position+" label", function(e) {
		 var val = $(this).find('input').val();
		 if(isset(val)){
 		 $(this).parents('.sor_side_options_content').find( ".sor_live_layer_"+type+"position_"+position+" input" ).text('0').val('0');
		 }else{
 		 $(this).parents('.sor_side_options_content').find( ".sor_live_layer_"+type+"position_"+position+" input" ).text('').val('');
		 }
		$(this).parents('.sor_side_options_content').sor_layer_postion_size();

	});
}
sor_align_change('','horizontal');
sor_align_change('','vertical');
sor_align_change('tablet_','horizontal');
sor_align_change('tablet_','vertical');
sor_align_change('mobile_','horizontal');
sor_align_change('mobile_','vertical');
  
$(document).on('click','.sor_panel_title',function() {
 		 $('body').sor_layer_json();
 });
 
 
 
 
 
 
 });  
	
	
})(jQuery);

		